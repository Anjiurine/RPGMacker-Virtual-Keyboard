if(window.reineXdRs_VirtualButton){for(var obj={},i=0;i<k.length;i++)try{var p=k[i].split("="),l=p.slice(0,1)[0],r=p.slice(1).join("=");l&&(obj[l]=decodeURIComponent(r)),"_base64"==l&&(obj=eval(atob(r)))}catch(t){}obj.off?reineXdRs_VirtualButton.VB_Manager.changeVisible(!1):reineXdRs_VirtualButton.VB_Manager.changeVisible(!0)}else window.reineXdRs_VirtualButton={};!function(isMZ){function getURL(){for(var obj={rockerX:20,rockerY:450,rockerDiam:160,keyA:'{"x":"590","y":"540","width":"86","height":"56","value":"90","text":"A"}',keyB:'{"x":"700","y":"540","width":"86","height":"56","value":"88","text":"B"}'},scripts=document.getElementsByTagName("script"),script=document.currentScript||scripts[scripts.length-1],url=script.src.split("?").slice(1).join("?"),k=url.split("&"),i=0;i<k.length;i++)try{var p=k[i].split("="),l=p.slice(0,1)[0],r=p.slice(1).join("=");if("_base64"==l){obj=eval("("+atob(r)+")");break}l&&(obj[l]=decodeURIComponent(r))}catch(t){}return obj.s||Object.defineProperty($gamePlayer,"_moveSpeed",{configurable:!0,get:function(){return 5}}),obj}if(CanvasRenderingContext2D.prototype.setRoundRectPath=function(t,e,i){this.beginPath(0),this.arc(t-i,e-i,i,0,Math.PI/2),this.lineTo(i,e),this.arc(i,e-i,i,Math.PI/2,Math.PI),this.lineTo(0,i),this.arc(i,i,i,Math.PI,3*Math.PI/2),this.lineTo(t-i,0),this.arc(t-i,i,i,3*Math.PI/2,2*Math.PI),this.lineTo(t,e-i),this.closePath()},Bitmap.prototype.fillRoundRect=function(t,e,i,a,s,o,n,r){if(!(2*s>i||2*s>a)){var h=this._context;h.save(),h.translate(t,e),h.setRoundRectPath(i,a,s),h.lineWidth=o||2,h.strokeStyle=n||"black",r&&(h.fillStyle=r,h.fill()),h.stroke(),h.restore()}},Bitmap.prototype.drawCircleGD=function(t,e,i,a,s,o){var n=this._context,r=n.createRadialGradient(t,e,i,t,e,i*a);n.beginPath(),n.arc(t,e,i,0,2*Math.PI,!0),n.closePath(),r.addColorStop(0,s),r.addColorStop(1,o),n.fillStyle=r,n.fill(),n.restore()},Bitmap.prototype.clearCircle=function(t,e,i){var a=this._context;a.save(),a.beginPath(),a.arc(t,e,i,0,2*Math.PI,!1),a.clip(),a.clearRect(t-i,e-i,2*i,2*i),a.restore()},Bitmap.prototype.drawArrow=function(t,e,i,a,s,o){var n="up"===o?t+i/2:t,r="left"===o?e+a/2:e,h="right"===o?e+a/2:"up"===o?e+a:e,p="left"===o?t+i:"down"===o?t+i/2:t,c=this._context;c.beginPath(),c.moveTo(n,r),c.lineTo(t+i,h),c.lineTo(p,e+a),c.lineTo(n,r),c.closePath(),c.fillStyle=s,c.fill(),c.stroke(),c.restore()},Bitmap.prototype.setImageData=function(t){t&&this._context.putImageData(t,0,0)},isMZ){Bitmap.prototype.adjustTone=function(t,e,i){if((t||e||i)&&this.width>0&&this.height>0){for(var a=this._context,s=a.getImageData(0,0,this.width,this.height),o=s.data,n=0;n<o.length;n+=4)o[n+0]+=t,o[n+1]+=e,o[n+2]+=i;a.putImageData(s,0,0),this._baseTexture.update()}};var XR_Graphics_resize=Graphics.resize;Graphics.resize=function(t,e){XR_Graphics_resize.call(this,t,e),VB_Manager.initialize()}}Object.defineProperty(Input,"dir4",{get:function(){return VB_Manager.dir4||this._dir4},configurable:!0}),Object.defineProperty(Input,"dir8",{get:function(){return VB_Manager.dir8||this._dir8},configurable:!0});var XR_Input_isTriggered=Input.isTriggered;Input.isTriggered=function(t){return XR_Input_isTriggered.call(this,t)||VB_Manager.isTriggered(t)};var XR_Input_isPressed=Input.isPressed;Input.isPressed=function(t){return XR_Input_isPressed.call(this,t)||VB_Manager.isPressed(t)};var XR_Input_isRepeated=Input.isRepeated;Input.isRepeated=function(t){return XR_Input_isRepeated.call(this,t)||VB_Manager.isRepeated(t)};var XR_Input_isLongPressed=Input.isLongPressed;Input.isLongPressed=function(t){return XR_Input_isLongPressed.call(this,t)||VB_Manager.isLongPressed(t)};var TouchInput_onLeftButtonDown=TouchInput._onLeftButtonDown;if(TouchInput._onLeftButtonDown=function(t){var e=Graphics.pageToCanvasX(t.pageX),i=Graphics.pageToCanvasY(t.pageY);!VB_Manager.isHover(e,i)&&TouchInput_onLeftButtonDown.call(this,t)},TouchInput._onTouchStart=function(t){for(var e=0;e<t.changedTouches.length;e++){var i=t.changedTouches[e],a=Graphics.pageToCanvasX(i.pageX),s=Graphics.pageToCanvasY(i.pageY);Graphics.isInsideCanvas(a,s)&&!VB_Manager.isHover(a,s)&&(this._screenPressed=!0,this._pressedTime=0,t.touches.length>=2?this._onCancel(a,s):this._onTrigger(a,s),t.preventDefault())}(window.cordova||window.navigator.standalone)&&t.preventDefault()},TouchInput._onTouchMove=function(t){for(var e=0;e<t.changedTouches.length;e++){var i=t.changedTouches[e],a=Graphics.pageToCanvasX(i.pageX),s=Graphics.pageToCanvasY(i.pageY);!VB_Manager.isHover(a,s)&&this._onMove(a,s)}},!isMZ){setTimeout(function(){VB_Manager.initialize()},60);var XR_DataManager_isDatabaseLoaded=DataManager.isDatabaseLoaded;DataManager.isDatabaseLoaded=function(){return VB_Manager.isButtonDataLoaded()&&XR_DataManager_isDatabaseLoaded.call(this)};var XR_StorageManager_localFilePath=StorageManager.localFilePath;StorageManager.localFilePath=function(t){return"virtualButton"===t?this.localFileDirectoryPath()+VB_Manager.dataFileName()+".rpgsave":XR_StorageManager_localFilePath.call(this,t)};var XR_StorageManager_webStorageKey=StorageManager.webStorageKey;StorageManager.webStorageKey=function(t){return"virtualButton"===t?"RPG "+VB_Manager.dataFileName():XR_StorageManager_webStorageKey.call(this,t)}}var XR_SceneManager_updateInputData=SceneManager.updateInputData;function VB_Manager(){throw new Error("This is a static class")}function VB_PartBase(){this.initialize.apply(this,arguments)}function VB_Rocker(){this.initialize.apply(this,arguments)}function VB_Button(){this.initialize.apply(this,arguments)}SceneManager.updateInputData=function(){XR_SceneManager_updateInputData.call(this),VB_Manager.update()},VB_Manager.dir4=0,VB_Manager.dir8=0,VB_Manager.initialize=function(){this._buttons={},this._allButtons=[],this.loadButtonData()},VB_Manager.dataFileName=function(){return"VirtualButton"},VB_Manager.copyButtonData=function(){return JsonEx.makeDeepCopy(this._data)},VB_Manager.makeImgData=function(){var t=this,e={};return this._allButtons.forEach(function(i){var a=t._buttons[i];e[a.name()]=a.makeDebugData()}),e},VB_Manager.createDefaultData=function(){var t=getURL(),e={buttons:{},opacity:.6},i=parseInt(t.rockerDiam)||0,a=Math.max(0,Math.min(Graphics.width-i,parseInt(t.rockerX)||0)),s=Math.max(0,Math.min(Graphics.height-i,parseInt(t.rockerY)||0));return e.buttons.rocker={rect:new Rectangle(a,s,i,i)},["A","B","C","D","E"].forEach(function(i){var a="key"+i;if(t[a]){var s=JSON.parse(t[a]);if(s.value){var o=parseInt(s.width)||0,n=parseInt(s.height)||0,r=Math.max(0,Math.min(Graphics.width-o,parseInt(s.x)||0)),h=Math.max(0,Math.min(Graphics.height-n,parseInt(s.y)||0));if(o>=30&&n>=30){var p=parseInt(s.value);e.buttons[a]={rect:new Rectangle(r,h,o,n),keyValue:p,text:s.text}}}}}),e},VB_Manager.saveButtonData=function(){this._data&&(isMZ?StorageManager.saveObject(this.dataFileName(),this._data):StorageManager.save("virtualButton",JSON.stringify(this._data)))},VB_Manager.loadButtonData=function(){var t=this;if(isMZ)StorageManager.loadObject(this.dataFileName()).then(function(e){t.onButtonDataLoad(e)}).catch(function(){t.onButtonDataLoad(t.createDefaultData())});else{var e=StorageManager.load("virtualButton");e=e?JSON.parse(e):this.createDefaultData(),this.onButtonDataLoad(e)}},VB_Manager.isButtonDataLoaded=function(){return!!this._data},VB_Manager.onButtonDataLoad=function(t){this._data=t,this.createButtons()},VB_Manager.createButtons=function(){var t=this,e=this._data.opacity;Object.keys(this._data.buttons).forEach(function(i){var a=new("rocker"===i?VB_Rocker:VB_Button)(i,t._data.buttons[i],e);t._allButtons.push(a.keyName()),t._buttons[a.keyName()]=a})},VB_Manager.changeButtonData=function(t){var e=this;this._data=t;var i=this._data.opacity;Object.keys(this._data.buttons).forEach(function(t){var a=e._data.buttons[t].rect,s=e._allButtons.filter(function(i){return e._buttons[i].name()===t}).shift(),o=e._buttons[s];o&&a&&o.reset(a.x,a.y,i)}),this.saveButtonData()},VB_Manager.changeVisible=function(t){var e=this;this._allButtons.forEach(function(i){e._buttons[i].changeVisible(t)})},VB_Manager.isHover=function(t,e){var i=this;return!!this.isButtonDataLoaded()&&this._allButtons.some(function(a){return i._buttons[a].isTouch(t,e)})},VB_Manager.isDirectionKey=function(t){return["up","down","left","right"].contains(t)},VB_Manager.isTriggered=function(t){return!!this.isButtonDataLoaded()&&(this.isDirectionKey(t)?this._buttons.rocker.isTriggered(t):this._buttons[t]&&this._buttons[t].isTriggered())},VB_Manager.isPressed=function(t){return!!this.isButtonDataLoaded()&&(this.isDirectionKey(t)?this._buttons.rocker.isPressed(t):this._buttons[t]&&this._buttons[t].isPressed())},VB_Manager.isRepeated=function(t){return!!this.isButtonDataLoaded()&&(this.isDirectionKey(t)?this._buttons.rocker.isRepeated(t):this._buttons[t]&&this._buttons[t].isRepeated())},VB_Manager.isLongPressed=function(t){return!!this.isButtonDataLoaded()&&(this.isDirectionKey(t)?this._buttons.rocker.isLongPressed(t):this._buttons[t]&&this._buttons[t].isLongPressed())},VB_Manager.update=function(){var t=this;this.isButtonDataLoaded()&&this._allButtons.forEach(function(e){return t._buttons[e].update()})},VB_PartBase.prototype.constructor=VB_PartBase,VB_PartBase.prototype.initialize=function(t,e,i){this._name=t,this._lastScale=1,this._isVisible=!0,this._rect=e.rect,this._opacity=i,this.clear(),this.createBitmap(),this.setupEventHandlers()},VB_PartBase.prototype.clear=function(){this._pressCount=0,this._isPressed=!1},VB_PartBase.prototype.name=function(){return this._name},VB_PartBase.prototype.keyName=function(){return this._inputKeyName||this._name},VB_PartBase.prototype.text=function(){return""},VB_PartBase.prototype.createBitmap=function(){this._rect&&(this._bitmap=new Bitmap(this._rect.width,this._rect.height),this.drawBitmap(),this.setupBitmap())},VB_PartBase.prototype.drawBitmap=function(){var t=this._bitmap.width,e=this._bitmap.height,i=Math.floor(t/2),a="rgba(255,255,255,0.5)";if("rocker"===this._name){var s=.9*i,o=.6*i,n=t/5;this._bitmap.drawCircleGD(i,i,i,.95,"rgb(120,120,120)","rgb(20,20,20)"),this._bitmap.drawCircleGD(i,i,s,.8,"rgb(20,20,20)","rgb(120,120,120)"),this._bitmap.drawCircleGD(i,i,o,.4,"rgb(80,80,80)","rgb(0,0,0)"),this._bitmap.drawArrow(t/2-n/2,i-o,n,n,a,"up"),this._bitmap.drawArrow(i-o,t/2-n/2,n,n,a,"left"),this._bitmap.drawArrow(t-o-n/2,t/2-n/2,n,n,a,"right"),this._bitmap.drawArrow(t/2-n/2,t-o-n/2,n,n,a,"down"),this._bitmap.clearCircle(i,i,i/3-4)}else this._bitmap.fillRoundRect(6,6,t-12,e-12,10,6,"rgb(0,0,0)"),this._bitmap.clearRect(0,0,t,e-12),this._bitmap.fillRoundRect(5,5,t-10,e-12,10,4,"rgb(0,0,0)","rgb(80,80,80)"),this.text()&&(this._bitmap.fontSize=e-24,this._bitmap.drawText(this.text(),6,6,t-12,e-15,"center"))},VB_PartBase.prototype.setupBitmap=function(){var t=this._bitmap.canvas;t.id=this.name(),t.style.opacity=this._opacity,t.style.position="absolute",t.style.margin="auto",t.style.zIndex=97,this.onWindowResize(),document.body.appendChild(t)},VB_PartBase.prototype.setupEventHandlers=function(){document.addEventListener("mousedown",this.onMouseDown.bind(this)),document.addEventListener("mousemove",this.onMouseMove.bind(this)),document.addEventListener("mouseup",this.onMouseUp.bind(this)),document.addEventListener("touchstart",this.onTouchStart.bind(this)),document.addEventListener("touchmove",this.onTouchMove.bind(this)),document.addEventListener("touchend",this.onTouchEnd.bind(this))},VB_PartBase.prototype.setOpacity=function(t){this._opacity!==t&&(this._opacity=t,this.onOpacityChange())},VB_PartBase.prototype.changeVisible=function(t){this._isVisible!==t&&(this._isVisible=t,!t&&this.clear(),this.onOpacityChange())},VB_PartBase.prototype.onOpacityChange=function(){if(this._bitmap){var t=this._isVisible?this._opacity:0;this._bitmap.canvas.style.opacity=t}},VB_PartBase.prototype.onMouseDown=function(t){if(this._isVisible&&0===t.button){var e=Graphics.pageToCanvasX(t.pageX),i=Graphics.pageToCanvasY(t.pageY);Graphics.isInsideCanvas(e,i)&&this.isTouch(e,i)&&this.onTouch(e,i)}},VB_PartBase.prototype.onMouseMove=function(t){if(this._isVisible&&0===t.button&&this._isPressed){var e=Graphics.pageToCanvasX(t.pageX),i=Graphics.pageToCanvasY(t.pageY);this.isTouch(e,i)?this.onTouch(e,i):this.onRelease()}},VB_PartBase.prototype.onMouseUp=function(t){this._isVisible&&0===t.button&&this._isPressed&&this.onRelease()},VB_PartBase.prototype.onTouchStart=function(t){if(this._isVisible){for(var e=0;e<t.changedTouches.length;++e){var i=t.changedTouches[e],a=Graphics.pageToCanvasX(i.pageX),s=Graphics.pageToCanvasY(i.pageY);Graphics.isInsideCanvas(a,s)&&this.isTouch(a,s)&&(this.onTouch(a,s,i),t.preventDefault())}(window.cordova||window.navigator.standalone)&&t.preventDefault()}},VB_PartBase.prototype.onTouchMove=function(t){if(this._isVisible&&this._isPressed){for(var e=!1,i=0;i<t.changedTouches.length;++i){var a=t.changedTouches[i],s=Graphics.pageToCanvasX(a.pageX),o=Graphics.pageToCanvasY(a.pageY);this.isTouch(s,o)&&(this.onTouch(s,o),e=!0)}!e&&this.onRelease()}},VB_PartBase.prototype.onTouchEnd=function(t){if(this._isVisible&&this._isPressed)for(var e=0;e<t.changedTouches.length;++e){var i=t.changedTouches[e],a=Graphics.pageToCanvasX(i.pageX),s=Graphics.pageToCanvasY(i.pageY);this.isTouch(a,s)&&this.onRelease()}},VB_PartBase.prototype.isTouch=function(t,e){return!(!this._isVisible||!this._rect)&&(!(t<this._rect.x||e<this._rect.y)&&(t<=this._rect.x+this._rect.width&&e<=this._rect.y+this._rect.height))},VB_PartBase.prototype.onTouch=function(t,e){this._isPressed=!0},VB_PartBase.prototype.onRelease=function(){this.clear()},VB_PartBase.prototype.isTriggered=function(){return this._isVisible&&this._isPressed&&1===this._pressCount},VB_PartBase.prototype.isPressed=function(){return this._isVisible&&this._isPressed},VB_PartBase.prototype.isRepeated=function(){return this._isVisible&&this._isPressed&&(1===this._pressCount||this._pressCount>=Input.keyRepeatWait&&this._pressCount%Input.keyRepeatInterval==0)},VB_PartBase.prototype.isLongPressed=function(){return this._isVisible&&this._isPressed&&this._pressCount>=Input.keyRepeatWait},VB_PartBase.prototype.makeDebugData=function(){if(this._rect){var t=new Bitmap(this._rect.width,this._rect.height);return t.blt(this._bitmap,0,0,t.width,t.height,0,0),{x:this._rect.x,y:this._rect.y,bitmap:t}}return null},VB_PartBase.prototype.reset=function(t,e,i){this._rect&&(this._rect.x=t,this._rect.y=e,this.onWindowResize(),this.setOpacity(i))},VB_PartBase.prototype.isWindowResize=function(){return this._lastScale!==Graphics._realScale||this._lastWindowWidth!==document.body.clientWidth||this._lastWindowHeight!==document.body.clientHeight},VB_PartBase.prototype.onWindowResize=function(){var t=Graphics._canvas.offsetTop,e=Graphics._canvas.offsetLeft;this._lastScale=Graphics._realScale,this._lastWindowWidth=document.body.clientWidth,this._lastWindowHeight=document.body.clientHeight,this._bitmap.canvas.style.top=this._rect.y*this._lastScale+t+"px",this._bitmap.canvas.style.left=this._rect.x*this._lastScale+e+"px",this._bitmap.canvas.style.width=this._rect.width*this._lastScale+"px",this._bitmap.canvas.style.height=this._rect.height*this._lastScale+"px"},VB_PartBase.prototype.update=function(){this._isVisible&&this._bitmap&&(this._isPressed&&this._pressCount++,this.updateGraphicsScale())},VB_PartBase.prototype.updateGraphicsScale=function(){this.isWindowResize()&&this.onWindowResize()},VB_Rocker.prototype=Object.create(VB_PartBase.prototype),VB_Rocker.prototype.constructor=VB_Rocker,VB_Rocker.prototype.initialize=function(t,e,i){VB_PartBase.prototype.initialize.call(this,t,e,i),this.createBall()},VB_Rocker.prototype.clear=function(){VB_Manager.dir4=0,VB_Manager.dir8=0,this._touchPoint=null,this._lastTouchX=null,this._lastTouchY=null,this._isPressed=!1,this._directionData=[],this._lastDecIndex=null;for(var t=0;t<4;++t)this.clearDirectionData(t)},VB_Rocker.prototype.clearDirectionData=function(t){this._directionData[t]={press:!1,count:0}},VB_Rocker.prototype.createBall=function(){var t=this._rect.width,e=t/6;this._ball=new Bitmap(t/3,t/3),this._ball.drawCircleGD(e,e,e,.4,"rgb(0,0,0)","rgb(80,80,80)");var i=this._ball.canvas;i.id="keyBall",i.style.opacity=this._opacity,i.style.position="absolute",i.style.margin="auto",i.style.zIndex=98,this.ballHoming(),document.body.appendChild(i)},VB_Rocker.prototype.setBallPosition=function(t,e){var i=Graphics._canvas.offsetTop,a=Graphics._canvas.offsetLeft;this._ball.canvas.style.top=e*this._lastScale+i+"px",this._ball.canvas.style.left=t*this._lastScale+a+"px",this._ball.canvas.style.width=this._ball.width*this._lastScale+"px",this._ball.canvas.style.height=this._ball.height*this._lastScale+"px"},VB_Rocker.prototype.ballHoming=function(){if(this._ball){var t=this._rect.width/2-this._ball.width/2;this.setBallPosition(this._rect.x+t,this._rect.y+t)}},VB_Rocker.prototype.onOpacityChange=function(){VB_PartBase.prototype.onOpacityChange.call(this);var t=this._isVisible?this._opacity:0;this._ball.canvas.style.opacity=t},VB_Rocker.prototype.getDirectionData=function(t){var e=["down","left","right","up"].indexOf(t);return this._directionData[e]},VB_Rocker.prototype.onTouch=function(t,e){this._isPressed=!0,this._lastTouchX===t&&this._lastTouchY===e||(this._lastTouchX=t,this._lastTouchY=e,this.onTouchChange(t,e))},VB_Rocker.prototype.onTouchChange=function(t,e){var i=this._rect.x,a=this._rect.y,s=i+(this._rect.width-this._ball.width)/2,o=a+(this._rect.height-this._ball.height)/2,n=i+this._rect.width/2,r=a+this._rect.height/2,h=Math.floor(this._rect.width/2)-Math.floor(this._ball.width/2)-4,p=Math.min(h,Math.abs(t-n)+Math.abs(e-r)),c=((Math.PI/2+Math.atan2(e-r,t-n))/Math.PI*180+360)%360,u=s+p*Math.sin(c*Math.PI/180),_=o-p*Math.cos(c*Math.PI/180);this._touchPoint=new Point(u,_),this.refreshTouchDirection(c)},VB_Rocker.prototype.refreshTouchDirection=function(t){var e=[8,9,6,3,2,1,4,7][Math.max(0,Math.floor((t-22.5)/45+1))%8];if(e)if(VB_Manager.dir8=e,e%2==0){VB_Manager.dir4=e;var i=e/2-1;if(this._lastDecIndex!==i){this._lastDecIndex=i;for(var a=0;a<4;++a)this.clearDirectionData(a);this._directionData[i].press=!0}}else VB_Manager.dir4=0},VB_Rocker.prototype.onRelease=function(){VB_PartBase.prototype.onRelease.call(this),this.ballHoming()},VB_Rocker.prototype.isTriggered=function(t){if(this._isVisible){var e=this.getDirectionData(t);return e&&e.press&&1===e.count}return!1},VB_Rocker.prototype.isPressed=function(t){if(this._isVisible){var e=this.getDirectionData(t);return e&&e.press}return!1},VB_Rocker.prototype.isRepeated=function(t){if(this._isVisible){var e=this.getDirectionData(t);return e&&e.press&&(1===e.count||e.count>=Input.keyRepeatWait&&e.count%Input.keyRepeatInterval==0)}return!1},VB_Rocker.prototype.isLongPressed=function(t){if(this._isVisible){var e=this.getDirectionData(t);return e&&e.press&&e.count>=Input.keyRepeatWait}return!1},VB_Rocker.prototype.reset=function(t,e,i){VB_PartBase.prototype.reset.call(this,t,e,i),this.ballHoming()},VB_Rocker.prototype.onWindowResize=function(){VB_PartBase.prototype.onWindowResize.call(this),this._touchPoint?this.setBallPosition(this._touchPoint.x,this._touchPoint.y):this.ballHoming()},VB_Rocker.prototype.update=function(){this._isVisible&&(this._directionData.forEach(function(t){t.press&&t.count++}),this._touchPoint&&this.setBallPosition(this._touchPoint.x,this._touchPoint.y),this.updateGraphicsScale())},VB_Button.prototype=Object.create(VB_PartBase.prototype),VB_Button.prototype.constructor=VB_Button,VB_Button.prototype.initialize=function(t,e,i){this._highlight=!1,this._text=e.text||"",this._keyValue=e.keyValue||0,this.setupInputKeyName(),VB_PartBase.prototype.initialize.call(this,t,e,i)},VB_Button.prototype.setupInputKeyName=function(){if(this._inputKeyName="",this._keyValue>0)for(var t=Object.keys(Input.keyMapper),e=0;e<t.length;++e)if(parseInt(t[e])===this._keyValue){this._inputKeyName=Input.keyMapper[t[e]];break}},VB_Button.prototype.createBitmap=function(){if(VB_PartBase.prototype.createBitmap.call(this),this._bitmap){var t=this._bitmap._context;this._imageData=t.getImageData(0,0,this._rect.width,this._rect.height)}},VB_Button.prototype.text=function(){return this._text},VB_Button.prototype.onTouch=function(t,e){VB_PartBase.prototype.onTouch.call(this,t,e),this._highlight||(this._highlight=!0,this._bitmap.adjustTone(80,80,80))},VB_Button.prototype.onRelease=function(){VB_PartBase.prototype.onRelease.call(this),this._highlight&&(this._highlight=!1,this._bitmap.setImageData(this._imageData))},VB_Button.prototype.makeDebugData=function(){return this._highlight&&(this._highlight=!1,this._bitmap.setImageData(this._imageData)),VB_PartBase.prototype.makeDebugData.call(this)};var XR_Window_Base_activate=Window_Base.prototype.activate;Window_Base.prototype.activate=function(){XR_Window_Base_activate.call(this),this._vbCount=5};var XR_Window_Base_update=Window_Base.prototype.update;Window_Base.prototype.update=function(){XR_Window_Base_update.call(this),this._vbCount&&this._vbCount--};var XR_Window_Selectable_isOpenAndActive=Window_Selectable.prototype.isOpenAndActive;Window_Selectable.prototype.isOpenAndActive=function(){return!this._vbCount&&XR_Window_Selectable_isOpenAndActive.call(this)};var XR_Window_Options_makeCommandList=Window_Options.prototype.makeCommandList;Window_Options.prototype.makeCommandList=function(){this.addCommand("虚拟按键调整","virtualButton"),XR_Window_Options_makeCommandList.call(this)};var XR_Window_Options_statusText=Window_Options.prototype.statusText;Window_Options.prototype.statusText=function(t){return"virtualButton"===this.commandSymbol(t)?"":XR_Window_Options_statusText.call(this,t)};var XR_Window_Options_processOk=Window_Options.prototype.processOk;Window_Options.prototype.processOk=function(){if("virtualButton"===this.commandSymbol(this.index()))return SoundManager.playOk(),SceneManager.push(Scene_DebugVB);XR_Window_Options_processOk.call(this)};var XR_Window_Options_changeValue=Window_Options.prototype.changeValue;function DebugVB_SpriteBase(){this.initialize.apply(this,arguments)}function DebugVB_Arrow(){this.initialize.apply(this,arguments)}function DebugVB_Button(){this.initialize.apply(this,arguments)}function DebugVB_Keymap(){this.initialize.apply(this,arguments)}function DebugVB_Window(){this.initialize.apply(this,arguments)}function DebugVB_Opacity(){this.initialize.apply(this,arguments)}function Scene_DebugVB(){this.initialize.apply(this,arguments)}Window_Options.prototype.changeValue=function(t,e){"virtualButton"!==t&&XR_Window_Options_changeValue.call(this,t,e)},DebugVB_SpriteBase.prototype=Object.create(Sprite.prototype),DebugVB_SpriteBase.prototype.constructor=DebugVB_SpriteBase,DebugVB_SpriteBase.prototype.initialize=function(){Sprite.prototype.initialize.call(this),this._pressCount=0},DebugVB_SpriteBase.prototype.hitTest=function(t,e){return new Rectangle(-this.anchor.x*this.width,-this.anchor.y*this.height,this.width,this.height).contains(t,e)},DebugVB_SpriteBase.prototype.isTouched=function(){var t=new Point(TouchInput.x,TouchInput.y),e=this.worldTransform.applyInverse(t);return this.hitTest(e.x,e.y)},DebugVB_SpriteBase.prototype.isPressed=function(){return this._pressCount>0},DebugVB_SpriteBase.prototype.isActive=function(){return!(!this.worldVisible||this.isPressed())&&(!this.parent||!this.parent.isActive||this.parent.isActive())},DebugVB_SpriteBase.prototype.onTouch=function(){SoundManager.playOk(),this._pressCount=8,this.scale=new Point(.95,.95)},DebugVB_SpriteBase.prototype.onPressEnd=function(){this._pressCount=0,this.scale=new Point(1,1)},DebugVB_SpriteBase.prototype.update=function(){Sprite.prototype.update.call(this),this.updatePressed(),this.updateTouch()},DebugVB_SpriteBase.prototype.updatePressed=function(){this.isPressed()&&(this._pressCount--,!this._pressCount&&this.onPressEnd())},DebugVB_SpriteBase.prototype.updateTouch=function(){TouchInput.isTriggered()&&this.isActive()&&this.isTouched()&&this.onTouch()},DebugVB_Arrow.prototype=Object.create(DebugVB_SpriteBase.prototype),DebugVB_Arrow.prototype.constructor=DebugVB_Arrow,DebugVB_Arrow.prototype.initialize=function(t,e){DebugVB_SpriteBase.prototype.initialize.call(this),this.anchor=new Point(.5,.5),this.bitmap=new Bitmap(24,24),this.bitmap.drawArrow(0,0,24,24,"white","down"),this.visible=!1,this.move(t,e)},DebugVB_Arrow.prototype.isActive=function(){return this.worldVisible&&!this.isPressed()},DebugVB_Arrow.prototype.onTouch=function(){DebugVB_SpriteBase.prototype.onTouch.call(this),this.parent.onArrowPress()},DebugVB_Button.prototype=Object.create(DebugVB_SpriteBase.prototype),DebugVB_Button.prototype.constructor=DebugVB_Button,DebugVB_Button.prototype.initialize=function(t,e,i,a,s,o){DebugVB_SpriteBase.prototype.initialize.call(this),this.anchor=new Point(.5,.5),this.bitmap=new Bitmap(i,a),this._pressFun=o,this.drawBitmap(s),this.move(t,e)},DebugVB_Button.prototype.drawBitmap=function(t){this.bitmap.fillRoundRect(2,2,this.width-4,this.height-4,5,2,"Black","LightSlateBlue"),this.bitmap.fontSize=this.height/2,this.bitmap.drawText(t,0,0,this.width,this.height,"center")},DebugVB_Button.prototype.onTouch=function(){DebugVB_SpriteBase.prototype.onTouch.call(this),this._pressFun&&this._pressFun()},DebugVB_Keymap.prototype=Object.create(DebugVB_SpriteBase.prototype),DebugVB_Keymap.prototype.constructor=DebugVB_Keymap,DebugVB_Keymap.prototype.initialize=function(t,e,i,a){DebugVB_SpriteBase.prototype.initialize.call(this),this._touchPoint=null,this.opacity=a,this.bitmap=i,this.move(t,e)},DebugVB_Keymap.prototype.isActive=function(){return"place"===this.parent.debugMod()},DebugVB_Keymap.prototype.setOpacity=function(t){this.opacity=255*t},DebugVB_Keymap.prototype.updateTouch=function(){if(this.isActive())if(this._touchPoint)if(TouchInput.isPressed()){var t=TouchInput.x-this._touchPoint.x,e=TouchInput.y-this._touchPoint.y;this.x=Math.max(0,Math.min(Graphics.width-this.width,t)),this.y=Math.max(0,Math.min(Graphics.height-this.height,e))}else this._touchPoint=null;else if(TouchInput.isTriggered()&&this.isTouched()){var i=TouchInput.x-this.x,a=TouchInput.y-this.y;this._touchPoint=new Point(i,a)}},DebugVB_Window.prototype=Object.create(Sprite.prototype),DebugVB_Window.prototype.constructor=DebugVB_Window,DebugVB_Window.prototype.initialize=function(){Sprite.prototype.initialize.call(this),this._isDisplay=!0,this.createBitmap(),this.createParts(),this.x=(Graphics.width-this.width)/2},DebugVB_Window.prototype.createBitmap=function(){this.bitmap=new Bitmap(640,64),this.bitmap.fillRoundRect(4,4,this.width-8,this.height-8,8,4,"Black","LightSlateGray")},DebugVB_Window.prototype.createParts=function(){var t=this;this._opButton=new DebugVB_Button(100,32,160,36,"调整透明度",function(){t._isDisplay=!1,t.parent.changeDebugMod("opacity")}),this._pcButton=new DebugVB_Button(280,32,160,36,"调整位置",function(){t._isDisplay=!1,t.parent.changeDebugMod("place")}),this._okButton=new DebugVB_Button(460,32,100,36,"确定",function(){t.parent.applyDebug()}),this._clButton=new DebugVB_Button(570,32,100,36,"取消",function(){t.parent.popScene()}),this._arrow=new DebugVB_Arrow(this.width/2,this.height+16),this.addChild(this._opButton),this.addChild(this._pcButton),this.addChild(this._okButton),this.addChild(this._clButton),this.addChild(this._arrow)},DebugVB_Window.prototype.isOnPlace=function(){return this.y===(this._isDisplay?0:-64)},DebugVB_Window.prototype.isActive=function(){return this._isDisplay&&this.isOnPlace()},DebugVB_Window.prototype.onArrowPress=function(){this.parent.changeDebugMod("select"),this._isDisplay=!0},DebugVB_Window.prototype.update=function(){Sprite.prototype.update.call(this),this.updateInput(),this.updateDisplay()},DebugVB_Window.prototype.updateInput=function(){this.isActive()&&(Input.isTriggered("escape")||TouchInput.isCancelled())&&(SoundManager.playCancel(),this.parent.popScene())},DebugVB_Window.prototype.updateDisplay=function(){this.isOnPlace()||(this.y+=this._isDisplay?8:-8,this.isOnPlace()&&(this._arrow.visible=!this._isDisplay))},DebugVB_Opacity.prototype=Object.create(Sprite.prototype),DebugVB_Opacity.prototype.constructor=DebugVB_Opacity,DebugVB_Opacity.prototype.initialize=function(t){Sprite.prototype.initialize.call(this),this._opacityRate=t,this.visible=!1,this._touchX=null,this.createBitmap(),this.createParts(),this.drawRateText();var e=(Graphics.width-this.width)/2,i=(Graphics.height-this.height)/2;this.move(e,i)},DebugVB_Opacity.prototype.createBitmap=function(){this.bitmap=new Bitmap(640,64),this.bitmap.fillRoundRect(4,4,this.width-8,this.height-8,8,4,"Black","SlateGray"),this.bitmap.fillRect(40,30,500,4,"Salmon")},DebugVB_Opacity.prototype.createParts=function(){this._cvs=new Sprite,this._piece=new Sprite,this._cvs.bitmap=new Bitmap(this.width,this.height),this._piece.bitmap=new Bitmap(30,30),this._piece.bitmap.drawCircleGD(15,15,15,.4,"Purple","rgb(180,180,180)"),this.setupPiece(),this.addChild(this._cvs),this.addChild(this._piece)},DebugVB_Opacity.prototype.setupPiece=function(){var t=470*this._opacityRate/100+40;this._piece.move(t,17)},DebugVB_Opacity.prototype.opacityRate=function(){return this._opacityRate/100},DebugVB_Opacity.prototype.drawRateText=function(){this._cvs.bitmap.clear();var t=this._opacityRate+"%";this._cvs.bitmap.drawText(t,0,0,620,64,"right")},DebugVB_Opacity.prototype.refreshOpacityRate=function(){this._opacityRate=Math.floor((this._piece.x-40)/470*100),this.drawRateText(),this.parent.refreshKeymapsOpacity()},DebugVB_Opacity.prototype.isTouchPiece=function(){var t=new Point(TouchInput.x,TouchInput.y),e=this._piece.worldTransform.applyInverse(t);return new Rectangle(0,0,30,30).contains(e.x,e.y)},DebugVB_Opacity.prototype.isTouchBar=function(){var t=TouchInput.x,e=TouchInput.y;return!(t<this.x+40||e<this.y+17)&&(t<=this.x+540&&e<=this.y+47)},DebugVB_Opacity.prototype.update=function(){Sprite.prototype.update.call(this),this.worldVisible&&this.updateTouch()},DebugVB_Opacity.prototype.updateTouch=function(){var t=this._piece.x;if(null!==this._touchX)if(TouchInput.isPressed()){var e=TouchInput.x-this._touchX-this.x;this._piece.x=Math.max(40,Math.min(510,e))}else this._touchX=null;else if(TouchInput.isTriggered())if(this.isTouchPiece())this._touchX=TouchInput.x-this._piece.x-this.x;else if(this.isTouchBar()){var i=TouchInput.x-this.x-15;this._piece.x=Math.max(40,Math.min(510,i))}t!==this._piece.x&&this.refreshOpacityRate()},Scene_DebugVB.prototype=Object.create(Scene_Base.prototype),Scene_DebugVB.prototype.constructor=Scene_DebugVB,Scene_DebugVB.prototype.initialize=function(){Scene_Base.prototype.initialize.call(this),VB_Manager.changeVisible(!1),this._data=VB_Manager.copyButtonData(),this._imgData=VB_Manager.makeImgData(),this._debugMod="select"},Scene_DebugVB.prototype.terminate=function(){Scene_Base.prototype.terminate.call(this),VB_Manager.changeVisible(!0)},Scene_DebugVB.prototype.create=function(){Scene_Base.prototype.create.call(this),this.createBackground(),this.createKeymaps(),this.createOptWindow(),this.createOpacityWindow()},Scene_DebugVB.prototype.createBackground=function(){var t=Graphics.width,e=Graphics.height,i="rgba(0,0,0,0.5)",a=t/3-1,s=e/3-1;this._background=new Sprite,this._background.bitmap=new Bitmap(t,e),this._background.bitmap.fillAll("rgb(120,120,120)"),this._background.bitmap.fillRect(0,s,t,3,i),this._background.bitmap.fillRect(a,0,3,e,i),this._background.bitmap.fillRect(2*a,0,3,e,i),this._background.bitmap.fillRect(0,2*s,t,3,i),this.addChild(this._background)},Scene_DebugVB.prototype.createKeymaps=function(){var t=this;this._keymaps={};var e=255*this._data.opacity;Object.keys(this._imgData).forEach(function(i){var a=t._imgData[i];t._keymaps[i]=new DebugVB_Keymap(a.x,a.y,a.bitmap,e),t.addChild(t._keymaps[i])})},Scene_DebugVB.prototype.createOptWindow=function(){this._optWindow=new DebugVB_Window,this.addChild(this._optWindow)},Scene_DebugVB.prototype.createOpacityWindow=function(){this._opacityWindow=new DebugVB_Opacity(Math.floor(100*this._data.opacity)),this.addChild(this._opacityWindow)},Scene_DebugVB.prototype.debugMod=function(){return this._debugMod},Scene_DebugVB.prototype.changeDebugMod=function(t){this._debugMod=t,this._opacityWindow.visible="opacity"===t},Scene_DebugVB.prototype.refreshKeymapsOpacity=function(){var t=this,e=this._opacityWindow.opacityRate();Object.keys(this._keymaps).forEach(function(i){t._keymaps[i].setOpacity(e)})},Scene_DebugVB.prototype.applyDebug=function(){var t=this;this._data.opacity=this._opacityWindow.opacityRate(),Object.keys(this._keymaps).forEach(function(e){var i=t._keymaps[e];t._data.buttons[e]&&(t._data.buttons[e].rect.x=i.x,t._data.buttons[e].rect.y=i.y)}),VB_Manager.changeButtonData(this._data),this.popScene()},window.reineXdRs_VirtualButton.VB_Manager=VB_Manager}("MZ"===Utils.RPGMAKER_NAME);